<tal:master define="level options/level|python:0;
                    children options/children | nothing;
                    bottomLevel options/bottomLevel | nothing;"
            i18n:domain="plone">

<metal:main define-macro="nav_main">
    <tal:navitem repeat="node children">
    <tal:block define="show_children   node/show_children;
                       children        node/children;
                       has_children    python:len(children) > 0;
                       has_subnav      python:has_children and show_children;
                       item_url        node/getURL;
                       is_current      node/currentItem;
                       is_last         python:level==1 and repeat['node'].end"
        tal:condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel">
        
         <li tal:define="li_class python:(is_current or has_subnav) and 'selected' or ''"
             tal:attributes="class python:is_last and ('last '+li_class) or li_class ">
        
                <a tal:define="item_class string:state-${node/normalized_review_state};"
                   tal:attributes="href python:item_url;
                                   title node/Title;
                                   class item_class"
                   tal:content="node/Title">Selected Item Title</a>
                   
            <tal:subnav condition="python:has_subnav">
                <ul tal:content="structure python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)" />
            </tal:subnav>  
            
        </li>
    
    </tal:block>
    </tal:navitem>
</metal:main>
</tal:master>
